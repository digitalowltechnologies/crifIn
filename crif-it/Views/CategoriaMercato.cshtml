@using Crif.It.Models;
@using Umbraco.Cms.Web.Common.PublishedModels;
@using Crif.It.Utils;
@using ContentModels = Crif.It.Models;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<CategoriaMercato>
@{
	Layout = "Master.cshtml";
	Category? categoria = (Category?)Model.Parent;
	var altreCat = categoria?.Siblings();
	var altriMerc = Model.SiblingsAndSelf()?.Where(x => x.ContentType.Alias == "categoriaMercato");

}
@if (categoria != null){
	<section class="internal-heading pb-lg-3">
		<div class="container-lg">
			<div class="row">
				<div class="col-12 banner">
					<div class="img-wrapper">
						<img src="@categoria?.ImmagineCategory?.Url()" alt="@HtmlUtils.GetImageAlt(categoria?.ImmagineCategory)">
					</div>
					<div class="caption">
						@await (Html.PartialAsync("Breadcrumb", categoria))
							<h1 class="h1 fade-in-box">@categoria?.TitoloCategory</h1>
						<p class="big-text fade-in-box">@HtmlUtils.TextCut(categoria?.DescrizioneCategory,200)</p>
					</div>
				</div>
			</div>
		</div>
	</section>
}
@if(altriMerc!=null && altriMerc.Any())
{
	<div class="decade-banner">
		<section class="internal-navigation mt-3 mt-lg-5">
			<div class="container-lg">
				<div class="row">
					<div class="col-12">
						<nav>
							<ul class="internal-menu">
								@foreach (var merc in altriMerc.OrderBy(altriMerc => altriMerc.Value("ordineMercato")))
								{
									var current = (merc.Name == Model.Name) ? "current" : "";
									<li class="nav-item @current"><a title="@merc.Name" href="@merc.Url()" class="nav-link"  data-link-type="filter" data-link-destiantion="@merc.Url()" data-link-filterCategory="@merc.Name" data-link-filterScroll="undefined">@merc.Name</a></li>
								}
								@if (categoria?.CtaNavigazioneInterna != null)
								{
									<li class="nav-item ms-auto"><a title="@categoria.CtaNavigazioneInterna.Name" href="@categoria.CtaNavigazioneInterna.Url" class="btn btn-primary" data-link-type="cta" data-link="@categoria.CtaNavigazioneInterna.Name" data-link-destination="@categoria.CtaNavigazioneInterna.Url" data-link-section="internal-navigation">@categoria.CtaNavigazioneInterna.Name</a></li>
								}
							</ul>
						</nav>
					</div>
				</div>
			</div>
		</section>
	</div>
}
@Html.GetBlockListHtml(Model.BlocchiCategoriaMercato)
@if(altreCat!=null && altreCat.Any() && Model.MostraSezioneAutomatica){
	<section class="cards-block bg" data-section="altre-categorie">
	<div class="container-lg">
		@if (Model?.TitoloSezioneAutomatica != "")
		{
		<div class="row justify-content-center">
			<div class="col-7 col-lg-12">
				<h2 class="h2 text-center pb-lg-5 mb-lg-4">@Model?.TitoloSezioneAutomatica</h2>
			</div>
		</div>
		}
		<div class="row g-mega g-overflow">
		@foreach (Category cat in altreCat)
		{
			var soluzioni = cat?.Children()?.Where(x => x.ContentType.Alias == "soluzione");
			<div class="col-12 col-lg-6 service">
				<div class="custom-card shadow">
					<div class="img-wrapper">
						<img src="@cat?.ImmagineCategory?.Url()" alt="@HtmlUtils.GetImageAlt(cat?.ImmagineCategory)">
					</div>
					<div class="card-body">
						<div class="icon-wrapper"><img src="@cat?.IconaCategory?.Url()" alt="@HtmlUtils.GetImageAlt(cat?.IconaCategory)"></div>
						<h2 class="h3 card-title">@cat?.TitoloCategory</h2>
						<p>@HtmlUtils.TextCut(cat?.AbstractCategory)</p>
						<a title="Read more" href="@cat?.Url()" class="more" data-link-type="page" data-link="@cat?.TitoloCategory" data-link-destination="@cat?.Url()" data-link-section="@Model?.TitoloSezioneAutomatica">@Umbraco.GetDictionaryValue("family_read_more")</a>
					</div>
					@if (soluzioni != null && soluzioni.Any())
					{
						<div>
							<button class="card-dropdown-toggle collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#card-@cat?.Id-dropdown" aria-expanded="false" aria-controls="card-@cat?.Id-dropdown">@Umbraco.GetDictionaryValue("soluzioni_accordion_label")</button>
						</div>
						<div class="card-dropdown collapse" id="card-@cat?.Id-dropdown">
							<ul>
								@foreach (var soluzione in soluzioni)
								{
									<li><a title="@soluzione.Name" href="@soluzione.Url()" data-link-type="page" data-link="@soluzione.Name" data-link-destination="@soluzione.Url()" data-link-section="@Model?.TitoloSezioneAutomatica">@soluzione.Name</a></li>
								}
							</ul>
						</div>
					}
				</div>
			</div>
		}
			</div>
	</div>
</section>
}
