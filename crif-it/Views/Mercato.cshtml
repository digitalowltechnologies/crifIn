@using Crif.It.Models;
@using Umbraco.Cms.Web.Common.PublishedModels;
@using Crif.It.Utils;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Mercato>
@{
	Layout = "Master.cshtml";
}
<section class="internal-heading pb-lg-3">
	<div class="container-lg">
		<div class="row">
			<div class="col-12 banner">
				<div class="img-wrapper">
					<img src="@Model?.ImmagineHeroMercato?.Url()" alt="@HtmlUtils.GetImageAlt(Model?.ImmagineHeroMercato)">
				</div>
				<div class="caption">
					@await (Html.PartialAsync("Breadcrumb", Umbraco.AssignedContentItem))
						<h1 class="h1 fade-in-box">@Model?.TitoloHeroMercato</h1>
					<p class="big-text fade-in-box">@HtmlUtils.TextCut(Model?.DescrizioneHeroMercato,200)</p>
				</div>
			</div>
		</div>
	</div>
</section>
@Html.GetBlockListHtml(Model?.BlocchiMercato)
@if (Model != null && Model.MostrareUltimiArticoli)
{
	var orderedArticles = Model?.Root()?.DescendantsOfType("articolo").OrderByDescending(articles => articles.Value("dataCustom"));
	switch(Model?.TipologiaArticoli?.First().ContentType.Alias){
		case "newsEdEventi":
		case "ricercheAcademy":
		case "ricerche":
		case "academy":
			orderedArticles = Model?.TipologiaArticoli.First().DescendantsOfType("articolo").OrderByDescending(articles => articles.Value("dataCustom"));
			break;
		case "news":
		case "eventi":
		case "areaStampa":
		case "storieDiSuccesso":
			orderedArticles = Model?.TipologiaArticoli.First()?.Children()?.OrderByDescending(articles => articles.Value("dataCustom"));
			break;
		default:
			break;
	}
	int count = 1;
	<section class="vertical-cards-block bg pb-80">
		<div class="container-lg">
			@if (!string.IsNullOrEmpty(Model?.TitoloUltimiArticoli))
			{
				<div class="row justify-content-center">
					<div class="col-12">
						<h2 class="h2 text-center pb-lg-5 mb-lg-4">@Model?.TitoloUltimiArticoli</h2>
					</div>
				</div>
			}
			<div class="row g-large">

				@foreach (Articolo art in orderedArticles)
				{
					if (count == 4)
					{
						break;
					}
					@(await Html.PartialAsync("CardArticolo", art, new ViewDataDictionary(ViewData){ {"list", "related" },{"section",@Model?.TitoloUltimiArticoli} }))
					count++;
				}
			</div>
		</div>
	</section>
}
@Html.GetBlockListHtml(Model?.AltriBlocchi)